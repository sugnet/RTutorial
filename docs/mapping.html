<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 8 Vectorized programming and mapping functions | Introduction into R Applications and Programming: A Tutorial</title>
<meta name="author" content="NiÃ«l J le Roux and Sugnet Lubbe">
<meta name="description" content="In this chapter we continue the study the art of R programming. An important topic is a set of tools operating on objects like matrices, dataframes and lists as wholes.  8.1 Mapping functions to a...">
<meta name="generator" content="bookdown 0.44 with bs4_book()">
<meta property="og:title" content="Chapter 8 Vectorized programming and mapping functions | Introduction into R Applications and Programming: A Tutorial">
<meta property="og:type" content="book">
<meta property="og:url" content="https://github.com/sugnet/RTutorial/mapping.html">
<meta property="og:image" content="https://github.com/sugnet/RTutorial/frontcover.jpg">
<meta property="og:description" content="In this chapter we continue the study the art of R programming. An important topic is a set of tools operating on objects like matrices, dataframes and lists as wholes.  8.1 Mapping functions to a...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 8 Vectorized programming and mapping functions | Introduction into R Applications and Programming: A Tutorial">
<meta name="twitter:description" content="In this chapter we continue the study the art of R programming. An important topic is a set of tools operating on objects like matrices, dataframes and lists as wholes.  8.1 Mapping functions to a...">
<meta name="twitter:image" content="https://github.com/sugnet/RTutorial/frontcover.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.9.0/transition.js"></script><script src="libs/bs3compat-0.9.0/tabs.js"></script><script src="libs/bs3compat-0.9.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 1em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Introduction into R Applications and Programming: A Tutorial</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Introducing the R System</a></li>
<li><a class="" href="objects.html"><span class="header-section-number">2</span> Managing objects</a></li>
<li><a class="" href="operators.html"><span class="header-section-number">3</span> R operators and functions</a></li>
<li><a class="" href="graphics.html"><span class="header-section-number">4</span> Introducing traditional R graphics</a></li>
<li><a class="" href="subscripting.html"><span class="header-section-number">5</span> Subscripting</a></li>
<li><a class="" href="revision.html"><span class="header-section-number">6</span> Revision tasks</a></li>
<li><a class="" href="functions.html"><span class="header-section-number">7</span> Writing functions in R</a></li>
<li><a class="active" href="mapping.html"><span class="header-section-number">8</span> Vectorized programming and mapping functions</a></li>
<li><a class="" href="data.html"><span class="header-section-number">9</span> Reading data files into R, formatting and printing</a></li>
<li><a class="" href="graphics2.html"><span class="header-section-number">10</span> R graphics: Round II</a></li>
<li><a class="" href="modelling.html"><span class="header-section-number">11</span> Statistical modelling with R</a></li>
<li><a class="" href="optimisation.html"><span class="header-section-number">12</span> Introduction to Optimisation</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/sugnet/RTutorial">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="mapping" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Vectorized programming and mapping functions<a class="anchor" aria-label="anchor" href="#mapping"><i class="fas fa-link"></i></a>
</h1>
<p>In this chapter we continue the study the art of R programming. An important topic is a set of tools operating on objects like matrices, dataframes and lists as wholes.</p>
<div id="mapping-functions-to-a-matrix" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Mapping functions to a matrix<a class="anchor" aria-label="anchor" href="#mapping-functions-to-a-matrix"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: lower-alpha">
<li><p>What is understood by a mapping function and of what use are such functions?</p></li>
<li>
<p>The function <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code>.</p>
<ol style="list-style-type: lower-roman">
<li><p>What three arguments are required?</p></li>
<li><p>Suppose the third argument is a function. How are the arguments of this function used within <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code>?</p></li>
</ol>
</li>
</ol>
<div style="margin-left: 40px; margin-right: 20px;">
<ul>
<li><p>What is the result of the instruction <code>apply(is.na(x),2,all)</code>?</p></li>
<li><p>What is the result of the instruction <code>x[ ,!apply(is.na(x), 2,all)]</code>?</p></li>
<li><p>What is the result of the instruction <code>x[ ,!apply(is.na(x), 2,any)]</code>?</p></li>
<li><p>Set the random seed to 137921. Obtain a matrix <span class="math inline">\(\mathbf{A}:10 \times 6\)</span> of random <span class="math inline">\(n(0, 1)\)</span> values. Use <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> to find the <span class="math inline">\(10\%\)</span> trimmed mean of each row.</p></li>
</ul>
</div>
<ol start="3" style="list-style-type: lower-alpha">
<li>
<p>The function <code><a href="https://rdrr.io/r/base/sweep.html">sweep()</a></code>.</p>
<ol style="list-style-type: lower-roman">
<li><p>What arguments are required?</p></li>
<li><p>What are the similarities and differences between the arguments of <code><a href="https://rdrr.io/r/base/sweep.html">sweep()</a></code> and <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code>?</p></li>
<li><p>Normalise the columns of a given matrix to have zero means and unit variances using <code><a href="https://rdrr.io/r/base/scale.html">scale()</a></code>, <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> and <code><a href="https://rdrr.io/r/base/sweep.html">sweep()</a></code>. Which method is the fastest?</p></li>
</ol>
</li>
<li><p>The function <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code>.</p></li>
</ol>
<p>The usage is illustrated in the following diagram.</p>
<div class="inline-figure"><img src="pics/ifelse.jpg" width="100%"></div>
<div style="margin-left: 25px; margin-right: 20px;">
<ol style="list-style-type: lower-roman">
<li><p>Note the difference between the function <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> and the control statement: <code>if</code> - <code>else</code>.</p></li>
<li><p>What arguments are required?</p></li>
<li><p>Study the help file in detail.</p></li>
</ol>
</div>
<ol start="5" style="list-style-type: lower-alpha">
<li>
<p>The function <code><a href="https://rdrr.io/r/base/outer.html">outer()</a></code>.</p>
<ol style="list-style-type: lower-roman">
<li><p>What arguments are required?</p></li>
<li><p>Revise our previous example of <code><a href="https://rdrr.io/r/base/outer.html">outer()</a></code> when constructing a perspective plot with <code><a href="https://rdrr.io/r/graphics/persp.html">persp()</a></code>.</p></li>
</ol>
</li>
<li>
<p>Work through the following examples and note in particular how the above functions are used together:</p>
<ol style="list-style-type: lower-roman">
<li><p>Find the maximum value(s) in each column of the <code>LifeCycleSavings</code> data set.</p></li>
<li><p>Use <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> together with <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> to divide each column of the LifeCycleSaving data set into low, medium and high.</p></li>
<li><p>Use <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> to plot each column of the <code>LifeCycleSaving</code> data set against the ratio of <code>pop75</code> to <code>pop15</code> on the x-axis.</p></li>
<li><p>Use <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> to find the coefficient of variation of each column of the <code>LifeCycleSaving</code> data set.</p></li>
<li><p>Use <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> together with <code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code> and <code><a href="https://rdrr.io/r/base/cbind.html">rbind()</a></code> to obtain a table of the minimum and the maximum values of each column of the LifeCycleSaving data set.</p></li>
<li><p>Repeat (v) using the airquality data set with and without the elimination of the NAs by using an appropriate function definition in the call to <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code>.</p></li>
<li><p>Use <code><a href="https://rdrr.io/r/base/sweep.html">sweep()</a></code> to convert the <code>LifeCycleSaving</code> data set into standardized scores. Could <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> also be used for this task? Discuss.</p></li>
<li><p>Use <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> to convert negative values in a given vector to zero leaving positive values and missing values unchanged. Illustrate.</p></li>
</ol>
</li>
</ol>
</div>
<div id="mapping-functions-to-vectors-dataframes-and-lists" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> Mapping functions to vectors, dataframes and lists<a class="anchor" aria-label="anchor" href="#mapping-functions-to-vectors-dataframes-and-lists"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: lower-alpha">
<li><p>Study the functions <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code>, <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code> and <code><a href="https://rdrr.io/r/base/split.html">split()</a></code>.</p></li>
<li><p>Carefully study what is produced by the command</p></li>
</ol>
<div class="sourceCode" id="cb187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span> <span class="op">(</span><span class="va">state.x77</span><span class="op">)</span>,   </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span> <span class="op">(</span><span class="va">state.x77</span><span class="op">)</span><span class="op">$</span><span class="va">Illiteracy</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>, <span class="va">pairs</span><span class="op">)</span></span></code></pre></div>
<p><img src="08-mapping_files/figure-html/splitExample-1.png" width="672"><img src="08-mapping_files/figure-html/splitExample-2.png" width="672"><img src="08-mapping_files/figure-html/splitExample-3.png" width="672"></p>
<pre><code>#&gt; $`(0.498,1.27]`
#&gt; NULL
#&gt; 
#&gt; $`(1.27,2.03]`
#&gt; NULL
#&gt; 
#&gt; $`(2.03,2.8]`
#&gt; NULL</code></pre>
<div style="margin-left: 25px; margin-right: 20px;">
<p>Note: in order to see all graphs in the R-GUI it is necessary to issue the command</p>
</div>
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>ask<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> </span></code></pre></div>
<div style="margin-left: 25px; margin-right: 20px;">
<p>before calling the function <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code>.</p>
</div>
<ol start="3" style="list-style-type: lower-alpha">
<li>Use <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> to produce histograms of each of the variables in the <code>state.x77</code> data set such that each histogram has as title the correct variable name. The <span class="math inline">\(x\)</span>- and <span class="math inline">\(y\)</span>-axis must also be labelled correctly.</li>
</ol>
</div>
<div id="the-functions-mapply-rapply-and-vectorize" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> The functions: <code>mapply()</code>, <code>rapply()</code> and <code>Vectorize()</code><a class="anchor" aria-label="anchor" href="#the-functions-mapply-rapply-and-vectorize"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: lower-alpha">
<li>To apply a function to more than one list, <code><a href="https://rdrr.io/r/base/mapply.html">mapply()</a></code> is a multivariate version of <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code>. The first argument to <code><a href="https://rdrr.io/r/base/mapply.html">mapply()</a></code> is a function followed by the arguments for that function. The first argument function is applied to each of the elements in the following arguments.</li>
</ol>
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span> <span class="op">(</span><span class="kw">function</span> <span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,<span class="va">z</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span><span class="op">+</span><span class="va">y</span><span class="op">+</span><span class="va">z</span><span class="op">}</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span>, z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  7 16</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span> <span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,<span class="va">z</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,<span class="va">z</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,<span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">}</span>, </span>
<span>        x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span>, z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,] 1    3   </span></span>
<span><span class="co">#&gt; [2,] 4    8</span></span></code></pre></div>
<ol start="2" style="list-style-type: lower-alpha">
<li>Study the help-files of <code><a href="https://rdrr.io/r/base/rapply.html">rapply()</a></code> and <code><a href="https://rdrr.io/r/base/Vectorize.html">Vectorize()</a></code>.</li>
</ol>
</div>
<div id="the-mapping-function-tapply-for-grouped-data" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> The mapping function tapply() for grouped data<a class="anchor" aria-label="anchor" href="#the-mapping-function-tapply-for-grouped-data"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: lower-alpha">
<li><p>Study the arguments of <code><a href="https://rdrr.io/r/base/tapply.html">tapply()</a></code>.</p></li>
<li><p>Consider the <code>LifeCycleSavings</code> data set. Create an object <code>ddpigrp</code> that groups the <code>LifeCycleSavings</code> data into four groups G1, G2, G3 and G4 such that G1 members have <code>ddpi</code> within <span class="math inline">\((0, 2.0]\)</span>, G2 members have <code>ddpi</code> within <span class="math inline">\((2.0, 3.5]\)</span>, G3 members have <code>ddpi</code> within <span class="math inline">\((3.5, 5.0]\)</span>, and G4 members have <code>ddpi</code> larger than <span class="math inline">\(5.0\)</span>. Use <code><a href="https://rdrr.io/r/base/tapply.html">tapply()</a></code> to obtain the mean aggregate personal savings of each of the groups defined by <code>ddpigrp</code>.</p></li>
<li><p>If it is needed to break down a vector by more than one categorical variable, a list containing the grouping variables is used as the second argument to <code><a href="https://rdrr.io/r/base/tapply.html">tapply()</a></code>. Illustrate this by finding the mean aggregate personal savings of the groups in <code>ddpigrp</code> broken down by the <code>pop15</code> rating.</p></li>
<li><p>In order to use <code><a href="https://rdrr.io/r/base/tapply.html">tapply()</a></code> on more than one variable simultaneously <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> can be used to map <code><a href="https://rdrr.io/r/base/tapply.html">tapply()</a></code> to each of the variables in turn. Study the following command and its output carefully:</p></li>
</ol>
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddpigrp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span> <span class="op">(</span><span class="va">LifeCycleSavings</span><span class="op">$</span><span class="va">ddpi</span>, </span>
<span>                breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">3.5</span>, <span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">LifeCycleSavings</span><span class="op">$</span><span class="va">ddpi</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span> <span class="op">(</span><span class="st">"G"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span> <span class="op">(</span><span class="va">LifeCycleSavings</span> <span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span> <span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> </span>
<span>                                           <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span> <span class="op">(</span><span class="va">x</span>, <span class="va">ddpigrp</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt;           sr    pop75       dpi</span></span>
<span><span class="co">#&gt; G1  7.855385 1.790769  712.1677</span></span>
<span><span class="co">#&gt; G2  8.230625 2.456250 1497.0731</span></span>
<span><span class="co">#&gt; G3 11.959000 3.189000 1569.4910</span></span>
<span><span class="co">#&gt; G4 11.831818 1.834545  584.6964</span></span></code></pre></div>
<ol start="5" style="list-style-type: lower-alpha">
<li>If <code><a href="https://rdrr.io/r/base/tapply.html">tapply()</a></code> is called without a third argument it returns a vector of the same length than its first argument containing an index into the output that normally would be produced. Illustrate this behaviour and discuss its usage.</li>
</ol>
</div>
<div id="the-control-of-execution-flow-statement-if-else-and-the-control-functions-ifelse-and-switch" class="section level2" number="8.5">
<h2>
<span class="header-section-number">8.5</span> The control of execution flow statement if-else and the control functions <code>ifelse()</code> and <code>switch()</code><a class="anchor" aria-label="anchor" href="#the-control-of-execution-flow-statement-if-else-and-the-control-functions-ifelse-and-switch"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: lower-alpha">
<li>The primary tool for conditional computations is the <code>if</code> statement. It takes the form:</li>
</ol>
<div class="sourceCode" id="cb192"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb192-1"><a href="mapping.html#cb192-1" tabindex="-1"></a>if (logical condition evaluating to either TRUE or FALSE)</span>
<span id="cb192-2"><a href="mapping.html#cb192-2" tabindex="-1"></a>    {</span>
<span id="cb192-3"><a href="mapping.html#cb192-3" tabindex="-1"></a>     First set consisting of one or more R expressions</span>
<span id="cb192-4"><a href="mapping.html#cb192-4" tabindex="-1"></a>    }</span>
<span id="cb192-5"><a href="mapping.html#cb192-5" tabindex="-1"></a>else</span>
<span id="cb192-6"><a href="mapping.html#cb192-6" tabindex="-1"></a>    {</span>
<span id="cb192-7"><a href="mapping.html#cb192-7" tabindex="-1"></a>     Second set consisting of one or more R expressions</span>
<span id="cb192-8"><a href="mapping.html#cb192-8" tabindex="-1"></a>    } </span>
<span id="cb192-9"><a href="mapping.html#cb192-9" tabindex="-1"></a>Expression3</span></code></pre></div>
<ol start="2" style="list-style-type: lower-alpha">
<li><p>In the above the <code>else</code> and its accompanying expression(s) are optional.</p></li>
<li><p>If-else statements can be nested.</p></li>
<li><p>Remember that the function <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> operates on objects as wholes as illustrated below:</p></li>
</ol>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span>, ncol<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">xx</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">#&gt; [1,]    1    6   11   16   21</span></span>
<span><span class="co">#&gt; [2,]    2    7   12   17   22</span></span>
<span><span class="co">#&gt; [3,]    3    8   13   18   23</span></span>
<span><span class="co">#&gt; [4,]    4    9   14   19   24</span></span>
<span><span class="co">#&gt; [5,]    5   10   15   20   25</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">xx</span> <span class="op">&lt;</span> <span class="fl">10</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">#&gt; [1,]    0    0    1    1    1</span></span>
<span><span class="co">#&gt; [2,]    0    0    1    1    1</span></span>
<span><span class="co">#&gt; [3,]    0    0    1    1    1</span></span>
<span><span class="co">#&gt; [4,]    0    0    1    1    1</span></span>
<span><span class="co">#&gt; [5,]    0    1    1    1    1</span></span></code></pre></div>
<ol start="5" style="list-style-type: lower-alpha">
<li>Note that the function <code><a href="https://rdrr.io/r/base/match.html">match()</a></code> can be used as an alternative to multiple if-else statements in certain cases. The function <code><a href="https://rdrr.io/r/base/match.html">match()</a></code> takes as first argument a vector, <code>x</code>, of values to be matched and as second argument, <code>table</code>, a vector of possible values to be matched against. A third argument <code>nomatch = NA</code> specifies the return value if no match occurs. See the example below:</li>
</ol>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span> <span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NA  1  2 NA NA  2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span> <span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, nomatch <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0 1 2 0 0 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span> <span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>, nomatch <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0 2 1 0 0 1</span></span></code></pre></div>
<ol start="6" style="list-style-type: lower-alpha">
<li>The following example provides an illustration of the usage of <code><a href="https://rdrr.io/r/base/match.html">match()</a></code>:</li>
</ol>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">month.num</span> <span class="op">&lt;-</span> <span class="fl">5</span><span class="op">:</span><span class="fl">9</span></span>
<span><span class="va">month.name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"May"</span>, <span class="st">"June"</span>, <span class="st">"July"</span>, <span class="st">"Aug"</span>, <span class="st">"Sept"</span><span class="op">)</span></span>
<span><span class="va">new.vec</span> <span class="op">&lt;-</span>  <span class="va">month.name</span> <span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span> <span class="op">(</span><span class="va">airquality</span> <span class="op">[</span>, <span class="st">"Month"</span><span class="op">]</span>, <span class="va">month.num</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span> <span class="op">(</span><span class="va">airquality</span> <span class="op">[</span> ,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, MonthName <span class="op">=</span> <span class="va">new.vec</span>, </span>
<span>                   Day <span class="op">=</span> <span class="va">airquality</span><span class="op">$</span><span class="va">Day</span><span class="op">)</span></span>
<span><span class="va">out</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">148</span><span class="op">:</span><span class="fl">153</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;     Ozone Solar.R Wind Temp Month MonthName Day</span></span>
<span><span class="co">#&gt; 1      41     190  7.4   67     5       May   1</span></span>
<span><span class="co">#&gt; 2      36     118  8.0   72     5       May   2</span></span>
<span><span class="co">#&gt; 3      12     149 12.6   74     5       May   3</span></span>
<span><span class="co">#&gt; 4      18     313 11.5   62     5       May   4</span></span>
<span><span class="co">#&gt; 5      NA      NA 14.3   56     5       May   5</span></span>
<span><span class="co">#&gt; 148    14      20 16.6   63     9      Sept  25</span></span>
<span><span class="co">#&gt; 149    30     193  6.9   70     9      Sept  26</span></span>
<span><span class="co">#&gt; 150    NA     145 13.2   77     9      Sept  27</span></span>
<span><span class="co">#&gt; 151    14     191 14.3   75     9      Sept  28</span></span>
<span><span class="co">#&gt; 152    18     131  8.0   76     9      Sept  29</span></span>
<span><span class="co">#&gt; 153    20     223 11.5   68     9      Sept  30</span></span></code></pre></div>
<ol start="7" style="list-style-type: lower-alpha">
<li>The function <code><a href="https://rdrr.io/r/base/switch.html">switch()</a></code> provides an alternative to a set of nested if-else statements. It takes as first argument, <code>EXPR</code>, an integer value or a character string and as second argument, <code>...</code>, the list of alternatives. As an illustration:</li>
</ol>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">centre</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">type</span><span class="op">)</span> </span>
<span>  <span class="op">{</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html">switch</a></span><span class="op">(</span><span class="va">type</span>,</span>
<span>           mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>           median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>           trimmed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span>, trim <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Cauchy.html">rcauchy</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt;  [1] -1.80200491 -2.65459314 -4.50564590  0.64702874</span></span>
<span><span class="co">#&gt;  [5]  0.15695586  0.30853981  0.07360041 -9.63620378</span></span>
<span><span class="co">#&gt;  [9]  4.65920079  0.94245515</span></span>
<span><span class="fu">centre</span><span class="op">(</span><span class="va">x</span>,<span class="st">"mean"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -1.181067</span></span>
<span><span class="fu">centre</span><span class="op">(</span><span class="va">x</span>,<span class="st">"median"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1152781</span></span>
<span><span class="fu">centre</span><span class="op">(</span><span class="va">x</span>,<span class="st">"trimmed"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.854208</span></span></code></pre></div>
<ol start="8" style="list-style-type: lower-alpha">
<li>The two logical control operators <code>&amp;&amp;</code> and <code>||</code> are useful when using if-else statements. These two operators operate on logical expressions in contrast to the operators <code>&amp;</code> and <code>|</code> which operate on vectors/matrices.</li>
</ol>
</div>
<div id="loops-in-r" class="section level2" number="8.6">
<h2>
<span class="header-section-number">8.6</span> Loops in R<a class="anchor" aria-label="anchor" href="#loops-in-r"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: lower-alpha">
<li>
<code>for</code> loops: The general form is</li>
</ol>
<div class="sourceCode" id="cb197"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb197-1"><a href="mapping.html#cb197-1" tabindex="-1"></a>for (name in values)</span>
<span id="cb197-2"><a href="mapping.html#cb197-2" tabindex="-1"></a>      { expression(s)</span>
<span id="cb197-3"><a href="mapping.html#cb197-3" tabindex="-1"></a>      }</span></code></pre></div>
<div style="margin-left: 25px; margin-right: 20px;">
<p>This type of loop is useful if it is known in advance <em><span style="color:#FF9966">how many times</span></em> the statements in the loop are to be performed. In the above definition values can be either a vector or a list with elements not restricted to be numeric:</p>
</div>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">26</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">letters</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1 a </span></span>
<span><span class="co">#&gt; 2 b </span></span>
<span><span class="co">#&gt; 3 c </span></span>
<span><span class="co">#&gt; 4 d </span></span>
<span><span class="co">#&gt; 5 e </span></span>
<span><span class="co">#&gt; 6 f </span></span>
<span><span class="co">#&gt; 7 g </span></span>
<span><span class="co">#&gt; 8 h </span></span>
<span><span class="co">#&gt; 9 i </span></span>
<span><span class="co">#&gt; 10 j </span></span>
<span><span class="co">#&gt; 11 k </span></span>
<span><span class="co">#&gt; 12 l </span></span>
<span><span class="co">#&gt; 13 m </span></span>
<span><span class="co">#&gt; 14 n </span></span>
<span><span class="co">#&gt; 15 o </span></span>
<span><span class="co">#&gt; 16 p </span></span>
<span><span class="co">#&gt; 17 q </span></span>
<span><span class="co">#&gt; 18 r </span></span>
<span><span class="co">#&gt; 19 s </span></span>
<span><span class="co">#&gt; 20 t </span></span>
<span><span class="co">#&gt; 21 u </span></span>
<span><span class="co">#&gt; 22 v </span></span>
<span><span class="co">#&gt; 23 w </span></span>
<span><span class="co">#&gt; 24 x </span></span>
<span><span class="co">#&gt; 25 y </span></span>
<span><span class="co">#&gt; 26 z</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">letter</span> <span class="kw">in</span> <span class="va">letters</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">letter</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; a </span></span>
<span><span class="co">#&gt; b </span></span>
<span><span class="co">#&gt; c </span></span>
<span><span class="co">#&gt; d </span></span>
<span><span class="co">#&gt; e </span></span>
<span><span class="co">#&gt; f </span></span>
<span><span class="co">#&gt; g </span></span>
<span><span class="co">#&gt; h </span></span>
<span><span class="co">#&gt; i </span></span>
<span><span class="co">#&gt; j </span></span>
<span><span class="co">#&gt; k </span></span>
<span><span class="co">#&gt; l </span></span>
<span><span class="co">#&gt; m </span></span>
<span><span class="co">#&gt; n </span></span>
<span><span class="co">#&gt; o </span></span>
<span><span class="co">#&gt; p </span></span>
<span><span class="co">#&gt; q </span></span>
<span><span class="co">#&gt; r </span></span>
<span><span class="co">#&gt; s </span></span>
<span><span class="co">#&gt; t </span></span>
<span><span class="co">#&gt; u </span></span>
<span><span class="co">#&gt; v </span></span>
<span><span class="co">#&gt; w </span></span>
<span><span class="co">#&gt; x </span></span>
<span><span class="co">#&gt; y </span></span>
<span><span class="co">#&gt; z</span></span></code></pre></div>
<div style="margin-left: 25px; margin-right: 20px;">
<p>Consider a list consisting of several matrices, each with different numbers of rows but the same number of columns. Write an R function that will create a single matrix consisting of all the elements of the given list concatenated by rows.</p>
</div>
<ol start="2" style="list-style-type: lower-alpha">
<li>
<code>while</code> loops: The general form is</li>
</ol>
<div class="sourceCode" id="cb199"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb199-1"><a href="mapping.html#cb199-1" tabindex="-1"></a>while (condition)</span>
<span id="cb199-2"><a href="mapping.html#cb199-2" tabindex="-1"></a>        { expression(s)</span>
<span id="cb199-3"><a href="mapping.html#cb199-3" tabindex="-1"></a>        }</span></code></pre></div>
<div style="margin-left: 25px; margin-right: 20px;">
<p>This type of loop continues while condition evaluates to TRUE.</p>
</div>
<ol start="3" style="list-style-type: lower-alpha">
<li>Control inside loops: <code><a href="https://rdrr.io/r/base/Control.html">next</a></code> and <code><a href="https://rdrr.io/r/base/Control.html">break</a></code>
</li>
</ol>
<div style="margin-left: 25px; margin-right: 20px;">
<p>The command <code><a href="https://rdrr.io/r/base/Control.html">next</a></code> is used to skip over any remaining statements in the loop and continue executing. The command <code><a href="https://rdrr.io/r/base/Control.html">break</a></code> causes the immediate exit from the loop. In nested loops these commands apply to the most recently opened loop.</p>
</div>
<ol start="4" style="list-style-type: lower-alpha">
<li>
<code>repeat</code> loops: The general form is</li>
</ol>
<div class="sourceCode" id="cb200"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb200-1"><a href="mapping.html#cb200-1" tabindex="-1"></a>repeat { expression(s)</span>
<span id="cb200-2"><a href="mapping.html#cb200-2" tabindex="-1"></a>       }</span></code></pre></div>
<div style="margin-left: 25px; margin-right: 20px;">
<p>This type of loop continues until a break command is encountered.</p>
</div>
<ol start="5" style="list-style-type: lower-alpha">
<li><p>Remember that many operations that might be handled by loops can be more efficiently performed in R by using the subscripting tools discussed earlier.</p></li>
<li><p>As a further example we will consider the calculation of the Pearson chi-squared statistic for the test of independence in a two-way classification table:</p></li>
</ol>
<p><span class="math display">\[
\chi^2_p = \sum_{i=1}^r \sum_{j=1}^c \frac{(f_{ij}-e_{ij})^2}{e_{ij}}
\]</span></p>
<p>with <span class="math inline">\(e_{ij} = \frac{f_{i.}f_{.j}}{f_{..}}\)</span> the expected frequencies. This statistic can be calculated in R without using loops as follows:</p>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fi.</span> <span class="op">&lt;-</span> <span class="va">ftable</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span> <span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span> <span class="op">(</span><span class="va">ftable</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">f.j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span> <span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span> <span class="op">(</span><span class="va">ftable</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">ftable</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">fi.</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">f.j</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">fi.</span><span class="op">)</span></span>
<span><span class="va">X2p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span> <span class="op">(</span> <span class="op">(</span><span class="va">ftable</span><span class="op">-</span><span class="va">e</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span><span class="va">e</span><span class="op">)</span></span></code></pre></div>
<p>Explicit loops in R can potentially be expensive in terms of time and memory. The functions <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code>, <code><a href="https://rdrr.io/r/base/tapply.html">tapply()</a></code>, <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code> and <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> should be used instead if possible. The expected frequencies in the previous example can, for example, be obtained as follows:</p>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e.freq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span> <span class="op">(</span><span class="va">ftable</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span>,  <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span> <span class="op">(</span><span class="va">ftable</span>, <span class="fl">2</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">ftable</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="the-execution-time-of-r-tasks" class="section level2" number="8.7">
<h2>
<span class="header-section-number">8.7</span> The execution time of R tasks<a class="anchor" aria-label="anchor" href="#the-execution-time-of-r-tasks"><i class="fas fa-link"></i></a>
</h2>
<p>The functions <code><a href="https://rdrr.io/r/base/system.time.html">system.time()</a></code> and <code><a href="https://rdrr.io/r/base/proc.time.html">proc.time()</a></code> provide information regarding the execution of R tasks.</p>
<ol style="list-style-type: lower-alpha">
<li>
<code>proc.time</code> determines how much real and CPU time (in seconds) the currently running R process has already take:</li>
</ol>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html">proc.time</a></span><span class="op">(</span><span class="op">)</span>   <span class="co"># called with no arguments</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;    1.25    0.20    6.36</span></span></code></pre></div>
<ol start="2" style="list-style-type: lower-alpha">
<li>
<code>system.time(expr)</code> calls the function <code><a href="https://rdrr.io/r/base/proc.time.html">proc.time()</a></code>, evaluates <code>expr</code>, and then calls <code><a href="https://rdrr.io/r/base/proc.time.html">proc.time()</a></code> once more, returning the difference between the two <code><a href="https://rdrr.io/r/base/proc.time.html">proc.time()</a></code> calls:</li>
</ol>
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span> <span class="op">(</span><span class="fl">1000000</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="08-mapping_files/figure-html/systemtimeExample-1.png" width="672"></div>
<pre><code>#&gt;    user  system elapsed 
#&gt;    0.16    0.01    0.18</code></pre>
<div style="margin-left: 25px; margin-right: 20px;">
<p>Note that user and system times do not necessarily add up to elapsed time exactly.</p>
</div>
<ol start="3" style="list-style-type: lower-alpha">
<li><p>Write the necessary code using <code><a href="https://rdrr.io/r/base/proc.time.html">proc.time()</a></code> directly to obtain the execution time of <code>hist (rev (sort (rnorm (1000000))))</code>.</p></li>
<li>
<p>As an application of <code><a href="https://rdrr.io/r/base/system.time.html">system.time()</a></code> and <code><a href="https://rdrr.io/r/base/proc.time.html">proc.time()</a></code> perform the following simulation study: Given a covariance matrix <span class="math inline">\(\mathbf{S}:p \times p\)</span> the task is to compute the corresponding correlation matrix. The execution times of the following three methods are to be compared:</p>
<ol style="list-style-type: lower-roman">
<li><p>Direct elementwise calculation of <span class="math inline">\(r_{ij} = \frac{s_{ij}}{\sqrt{s_{ii}s_{jj}}}\)</span> using two nested for loops;</p></li>
<li><p>Two applications of <code><a href="https://rdrr.io/r/base/sweep.html">sweep()</a></code>;</p></li>
<li><p>Matrix multiplication where <span class="math inline">\(\mathbf{R}:p \times p = [diag(\mathbf{S})]^{-\frac{1}{2}} \mathbf{S} [diag(\mathbf{S})]^{-\frac{1}{2}}\)</span> where <span class="math inline">\(diag(\mathbf{A})\)</span> denotes the diagonal matrix formed from <span class="math inline">\(\mathbf{A}:p \times p\)</span> by setting all its off-diagonal elements equal to zero.</p></li>
</ol>
</li>
</ol>
<div style="margin-left: 25px; margin-right: 20px;">
<p>Use <code><a href="https://rdrr.io/r/stats/cor.html">var()</a></code> and <code><a href="https://rdrr.io/r/stats/Normal.html">rnorm()</a></code> to compute covariance matrices of different sizes <span class="math inline">\(p\)</span> from samples varying in size <span class="math inline">\(n\)</span>. Study the role of <span class="math inline">\(n\)</span> and <span class="math inline">\(p\)</span> in the effectiveness (economy in execution time) of the above three methods. Display the results graphically. Remember that for valid comparisons the three methods must be executed with identical samples.</p>
</div>
</div>
<div id="the-calling-of-functions-with-argument-lists" class="section level2" number="8.8">
<h2>
<span class="header-section-number">8.8</span> The calling of functions with argument lists<a class="anchor" aria-label="anchor" href="#the-calling-of-functions-with-argument-lists"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: lower-alpha">
<li>The function <code><a href="https://rdrr.io/r/base/do.call.html">do.call()</a></code> provides an alternative to the usual method of calling functions by name. It allows specifying the name of the function with its arguments in the form of a list:</li>
</ol>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span> <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">500</span><span class="op">)</span>, trim<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 51</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span> <span class="op">(</span><span class="st">"mean"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">500</span><span class="op">)</span>, trim<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 51</span></span></code></pre></div>
<ol start="2" style="list-style-type: lower-alpha">
<li><p>How does <code><a href="https://rdrr.io/r/base/do.call.html">do.call()</a></code> differ from the function <code><a href="https://rdrr.io/r/base/call.html">call()</a></code>?</p></li>
<li><p>As an illustration of the usage of <code><a href="https://rdrr.io/r/base/do.call.html">do.call()</a></code> study the following example:</p></li>
</ol>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">na.pattern</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">frame</span><span class="op">)</span></span>
<span><span class="op">{</span> <span class="va">nas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span> <span class="op">(</span><span class="va">frame</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mode.html">storage.mode</a></span> <span class="op">(</span><span class="va">nas</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"integer"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span> <span class="op">(</span><span class="st">"paste"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">nas</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">na.pattern</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">airquality</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 000000 010000 100000 110000 </span></span>
<span><span class="co">#&gt;    111      5     35      2</span></span></code></pre></div>
<div style="margin-left: 25px; margin-right: 20px;">
<p>What can be learned from the above output?</p>
</div>
<ol start="4" style="list-style-type: lower-alpha">
<li>What is the difference between <code><a href="https://rdrr.io/r/base/integer.html">as.integer()</a></code>, <code>storage.mode() &lt;â "integer"</code>, <code><a href="https://rdrr.io/r/base/mode.html">storage.mode()</a></code> and <code><a href="https://rdrr.io/r/base/mode.html">mode()</a></code>?</li>
</ol>
</div>
<div id="evaluating-r-strings-a-commands" class="section level2" number="8.9">
<h2>
<span class="header-section-number">8.9</span> Evaluating R strings a commands<a class="anchor" aria-label="anchor" href="#evaluating-r-strings-a-commands"><i class="fas fa-link"></i></a>
</h2>
<p>Recall from Figure <a href="functions.html#fig:expression">7.1</a> that the function <code>parse(text = "3 + 4")</code> returns the unevaluated expression <code>3 + 4</code>. In order to evaluate the expression use function <code><a href="https://rdrr.io/r/base/eval.html">eval()</a></code>: <code>eval (parse (text = "3 + 4"))</code> returns <code>7</code>.</p>
</div>
<div id="object-oriented-programming-in-r" class="section level2" number="8.10">
<h2>
<span class="header-section-number">8.10</span> Object oriented programming in R<a class="anchor" aria-label="anchor" href="#object-oriented-programming-in-r"><i class="fas fa-link"></i></a>
</h2>
<p>Suppose we would like to investigate the body of function <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>. We know that this can be done by entering the functionâs name at the R prompt:</p>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot</span></span>
<span><span class="co">#&gt; function (x, y, ...) </span></span>
<span><span class="co">#&gt; UseMethod("plot")</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x00000209a0d689c8&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:base&gt;</span></span></code></pre></div>
<p>The presence of <code>UseMethod("plot")</code> shows that <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> is a <em><span style="color:#FF9966">generic</span></em> function. The <em><span style="color:#FF9966">class</span></em> of an object determines how it will be treated by a generic function i.e.Â what <em><span style="color:#FF9966">method</span></em> will be applied to it. Function <code><a href="https://rdrr.io/r/methods/setClass.html">setClass()</a></code> is used for setting the class attribute of an object. Function <code><a href="https://rdrr.io/r/utils/methods.html">methods()</a></code> is used to find out (a) what is the repertoire of methods of a generic function and (b) what methods are available for a certain class:</p>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/methods.html">methods</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span> <span class="co"># repertoire of methods for FUNCTION plot()</span></span>
<span><span class="co">#&gt;  [1] plot.acf*           plot.data.frame*   </span></span>
<span><span class="co">#&gt;  [3] plot.decomposed.ts* plot.default       </span></span>
<span><span class="co">#&gt;  [5] plot.dendrogram*    plot.density*      </span></span>
<span><span class="co">#&gt;  [7] plot.ecdf           plot.factor*       </span></span>
<span><span class="co">#&gt;  [9] plot.formula*       plot.function      </span></span>
<span><span class="co">#&gt; [11] plot.hclust*        plot.histogram*    </span></span>
<span><span class="co">#&gt; [13] plot.HoltWinters*   plot.isoreg*       </span></span>
<span><span class="co">#&gt; [15] plot.lm*            plot.medpolish*    </span></span>
<span><span class="co">#&gt; [17] plot.mlm*           plot.ppr*          </span></span>
<span><span class="co">#&gt; [19] plot.prcomp*        plot.princomp*     </span></span>
<span><span class="co">#&gt; [21] plot.profile*       plot.profile.nls*  </span></span>
<span><span class="co">#&gt; [23] plot.R6*            plot.raster*       </span></span>
<span><span class="co">#&gt; [25] plot.spec*          plot.stepfun       </span></span>
<span><span class="co">#&gt; [27] plot.stl*           plot.table*        </span></span>
<span><span class="co">#&gt; [29] plot.ts             plot.tskernel*     </span></span>
<span><span class="co">#&gt; [31] plot.TukeyHSD*     </span></span>
<span><span class="co">#&gt; see '?methods' for accessing help and source code</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/methods.html">methods</a></span><span class="op">(</span>class<span class="op">=</span><span class="st">"lm"</span><span class="op">)</span>  <span class="co"># what methods are available for CLASS lm</span></span>
<span><span class="co">#&gt;  [1] add1           alias          anova         </span></span>
<span><span class="co">#&gt;  [4] case.names     coerce         confint       </span></span>
<span><span class="co">#&gt;  [7] cooks.distance deviance       dfbeta        </span></span>
<span><span class="co">#&gt; [10] dfbetas        drop1          dummy.coef    </span></span>
<span><span class="co">#&gt; [13] effects        extractAIC     family        </span></span>
<span><span class="co">#&gt; [16] formula        hatvalues      influence     </span></span>
<span><span class="co">#&gt; [19] initialize     kappa          labels        </span></span>
<span><span class="co">#&gt; [22] logLik         model.frame    model.matrix  </span></span>
<span><span class="co">#&gt; [25] nobs           plot           predict       </span></span>
<span><span class="co">#&gt; [28] print          proj           qr            </span></span>
<span><span class="co">#&gt; [31] residuals      rstandard      rstudent      </span></span>
<span><span class="co">#&gt; [34] show           simulate       slotsFromS3   </span></span>
<span><span class="co">#&gt; [37] summary        variable.names vcov          </span></span>
<span><span class="co">#&gt; see '?methods' for accessing help and source code</span></span></code></pre></div>
<p>In broad terms there are currently three types of classes in use in R: The old classes or S3 classes and the newer S4 and S5 (also called <em><span style="color:#FF9966">reference classes</span></em>) classes. The newer classes can contain one or more <em><span style="color:#FF9966">slots</span></em> which can be accessed using the operator <code>@</code>. Central to the concept of object oriented programming is that a method can inherit from another method. The function <code><a href="https://rdrr.io/r/base/UseMethod.html">NextMethod()</a></code> provides a mechanism for <em><span style="color:#FF9966">inheritance</span></em>.</p>
<ol style="list-style-type: lower-alpha">
<li><p>As an example of a generic function study the example in the help file of the function <code><a href="https://rdrr.io/r/base/all.equal.html">all.equal()</a></code>.</p></li>
<li><p>R provides many more facilities for writing object oriented functions. Consult the <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.pdf">R Language Definition Manual</a> Chapter 5: Object-Oriented Programming for further details.</p></li>
<li><p>A statistical investigation is often concerned with survey or questionnaire data where respondents must select one of several categorical alternatives. The <code>questdata</code> below shows the responses made by 10 respondents on four questions. The alternatives for each question were measured on a five point categorical scale. We can refer to the <code>questdata dataframe</code> as the full data. This form of representing the data is not an effective way of storing the data when the number of respondents is large. A more compact way of saving the data without any loss in information is to store the data in the form of a <em><span style="color:#FF9966">response pattern</span></em> matrix or dataframe. The first row of <code>questdata</code> constitutes one particular response pattern namely <code>("b" "c" "a" "d")</code>. A response pattern matrix (dataframe) shows all the unique response patterns together with the frequency with which each of the different response patterns has occurred. Your challenge is to provide the necessary R functions to convert the full data into a response pattern representation, and conversely to recover the full data from its response pattern representation.</p></li>
</ol>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">questdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"d"</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"d"</span>, <span class="st">"c"</span>, <span class="st">"a"</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"d"</span>, <span class="st">"c"</span>, <span class="st">"e"</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"d"</span>, <span class="st">"c"</span>, <span class="st">"e"</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"d"</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"d"</span>, <span class="st">"c"</span>, <span class="st">"e"</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"d"</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"d"</span>, <span class="st">"c"</span>, <span class="st">"a"</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"c"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"e"</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"d"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">questdata</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q1"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4"</span><span class="op">)</span></span></code></pre></div>
<div style="margin-left: 40px; margin-right: 20px;">
<ol style="list-style-type: lower-roman">
<li>Create the R object <code>questdata</code> and then give the following instructions:</li>
</ol>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span> <span class="op">(</span><span class="va">questdata</span> <span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "b" "d" "a" "c"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span> <span class="op">(</span><span class="va">questdata</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE</span></span>
<span><span class="co">#&gt; [10]  TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span> <span class="op">(</span><span class="va">questdata</span>, MARGIN <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE</span></span>
<span><span class="co">#&gt; [10]  TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span> <span class="op">(</span><span class="va">questdata</span>, MARGIN <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Q1    Q2    Q3    Q4 </span></span>
<span><span class="co">#&gt; FALSE FALSE FALSE FALSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span> <span class="op">(</span><span class="va">questdata</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Q1  Q2  Q3  Q4 </span></span>
<span><span class="co">#&gt; [1,] "b" "c" "a" "d"</span></span>
<span><span class="co">#&gt; [2,] "d" "d" "c" "a"</span></span>
<span><span class="co">#&gt; [3,] "a" "d" "c" "e"</span></span>
<span><span class="co">#&gt; [4,] "c" "b" "a" "e"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span> <span class="op">(</span><span class="va">questdata</span>, MARGIN <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Q1  Q2  Q3  Q4 </span></span>
<span><span class="co">#&gt; [1,] "b" "c" "a" "d"</span></span>
<span><span class="co">#&gt; [2,] "d" "d" "c" "a"</span></span>
<span><span class="co">#&gt; [3,] "a" "d" "c" "e"</span></span>
<span><span class="co">#&gt; [4,] "c" "b" "a" "e"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span> <span class="op">(</span><span class="va">questdata</span>, MARGIN <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Q1  Q2  Q3  Q4 </span></span>
<span><span class="co">#&gt;  [1,] "b" "c" "a" "d"</span></span>
<span><span class="co">#&gt;  [2,] "d" "d" "c" "a"</span></span>
<span><span class="co">#&gt;  [3,] "a" "d" "c" "e"</span></span>
<span><span class="co">#&gt;  [4,] "a" "d" "c" "e"</span></span>
<span><span class="co">#&gt;  [5,] "b" "c" "a" "d"</span></span>
<span><span class="co">#&gt;  [6,] "a" "d" "c" "e"</span></span>
<span><span class="co">#&gt;  [7,] "b" "c" "a" "d"</span></span>
<span><span class="co">#&gt;  [8,] "d" "d" "c" "a"</span></span>
<span><span class="co">#&gt;  [9,] "c" "b" "a" "e"</span></span>
<span><span class="co">#&gt; [10,] "b" "c" "a" "d"</span></span></code></pre></div>
<ol start="2" style="list-style-type: lower-roman">
<li><p>Examine Table <a href="operators.html#tab:MatrixFunc">3.5</a> and carefully describe the behaviour of the functions <code><a href="https://rdrr.io/r/base/duplicated.html">duplicated()</a></code> and <code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code>.</p></li>
<li><p>Write an R function, say <code>full2resp</code> to obtain the response pattern representation of questionnaire data like those given above. Test your function on <code>questdata</code>.</p></li>
<li><p>Write an R function, say <code>resp2full</code> to obtain the full data set given its response pattern representation. Test your function on the response pattern representation of the <code>questdata</code>.</p></li>
</ol>
</div>
</div>
<div id="recursion" class="section level2" number="8.11">
<h2>
<span class="header-section-number">8.11</span> Recursion<a class="anchor" aria-label="anchor" href="#recursion"><i class="fas fa-link"></i></a>
</h2>
<p>Functions in R can call themselves. This process is called <em><span style="color:#FF9966">recursion</span></em> and it is implemented in R programming by the function <code><a href="https://rdrr.io/r/base/Recall.html">Recall()</a></code>.</p>
<ol style="list-style-type: lower-alpha">
<li>As an example we will use recursion to calculate <span class="math inline">\(x(x+1)(x+2)\dots(x+k)\)</span> with <span class="math inline">\(k\)</span> a positive integer:</li>
</ol>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recurs.example</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span>, <span class="va">k</span><span class="op">)</span> </span>
<span><span class="op">{</span> <span class="co"># Function to calculate x(x+1)(x+2).....(x+k)</span></span>
<span>  <span class="co"># where k is a positive integer.</span></span>
<span>     <span class="kw">if</span> <span class="op">(</span><span class="va">k</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">)</span> </span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"k not allowed to be negative or non-integer"</span><span class="op">)</span></span>
<span>    <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span> <span class="va">k</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="va">x</span></span>
<span>       <span class="kw">else</span><span class="op">(</span><span class="va">x</span><span class="op">+</span><span class="va">k</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Recall.html">Recall</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>   <span class="op">}</span></span></code></pre></div>
<div style="margin-left: 25px; margin-right: 20px;">
<p>Investigate if <code>recurs.example()</code> works correctly.</p>
</div>
<ol start="2" style="list-style-type: lower-alpha">
<li>Explain how recursion works by studying the output of the following function for values of <span class="math inline">\(r = 1, 2, 3, 4, 5, 6\)</span>:</li>
</ol>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Recursiontest</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="op">{</span> <span class="kw">if</span> <span class="op">(</span><span class="va">r</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="cn">NULL</span></span>
<span>  <span class="kw">else</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Write = "</span>, <span class="va">r</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/Recall.html">Recall</a></span> <span class="op">(</span><span class="va">r</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/Recall.html">Recall</a></span> <span class="op">(</span><span class="va">r</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span></span>
<span>       <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">Recursiontest</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Write =  1</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="fu">Recursiontest</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Write =  2 </span></span>
<span><span class="co">#&gt; Write =  1</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="fu">Recursiontest</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Write =  3 </span></span>
<span><span class="co">#&gt; Write =  2 </span></span>
<span><span class="co">#&gt; Write =  1 </span></span>
<span><span class="co">#&gt; Write =  1</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="fu">Recursiontest</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; Write =  4 </span></span>
<span><span class="co">#&gt; Write =  3 </span></span>
<span><span class="co">#&gt; Write =  2 </span></span>
<span><span class="co">#&gt; Write =  1 </span></span>
<span><span class="co">#&gt; Write =  1 </span></span>
<span><span class="co">#&gt; Write =  2 </span></span>
<span><span class="co">#&gt; Write =  1</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="fu">Recursiontest</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; Write =  5 </span></span>
<span><span class="co">#&gt; Write =  4 </span></span>
<span><span class="co">#&gt; Write =  3 </span></span>
<span><span class="co">#&gt; Write =  2 </span></span>
<span><span class="co">#&gt; Write =  1 </span></span>
<span><span class="co">#&gt; Write =  1 </span></span>
<span><span class="co">#&gt; Write =  2 </span></span>
<span><span class="co">#&gt; Write =  1 </span></span>
<span><span class="co">#&gt; Write =  3 </span></span>
<span><span class="co">#&gt; Write =  2 </span></span>
<span><span class="co">#&gt; Write =  1 </span></span>
<span><span class="co">#&gt; Write =  1</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="fu">Recursiontest</span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="co">#&gt; Write =  6 </span></span>
<span><span class="co">#&gt; Write =  5 </span></span>
<span><span class="co">#&gt; Write =  4 </span></span>
<span><span class="co">#&gt; Write =  3 </span></span>
<span><span class="co">#&gt; Write =  2 </span></span>
<span><span class="co">#&gt; Write =  1 </span></span>
<span><span class="co">#&gt; Write =  1 </span></span>
<span><span class="co">#&gt; Write =  2 </span></span>
<span><span class="co">#&gt; Write =  1 </span></span>
<span><span class="co">#&gt; Write =  3 </span></span>
<span><span class="co">#&gt; Write =  2 </span></span>
<span><span class="co">#&gt; Write =  1 </span></span>
<span><span class="co">#&gt; Write =  1 </span></span>
<span><span class="co">#&gt; Write =  4 </span></span>
<span><span class="co">#&gt; Write =  3 </span></span>
<span><span class="co">#&gt; Write =  2 </span></span>
<span><span class="co">#&gt; Write =  1 </span></span>
<span><span class="co">#&gt; Write =  1 </span></span>
<span><span class="co">#&gt; Write =  2 </span></span>
<span><span class="co">#&gt; Write =  1</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<ol start="3" style="list-style-type: lower-alpha">
<li><p>Use recursion and the function <code><a href="https://rdrr.io/r/base/Recall.html">Recall()</a></code> to write an R function to calculate <span class="math inline">\(x!\)</span>.</p></li>
<li><p>Use recursion to write an R function that generates a matrix whose rows contain subsets of size <span class="math inline">\(r\)</span> of the first <span class="math inline">\(n\)</span> elements of the vector <code>v</code>. Ignore the possibility of repeated values in <code>v</code> and give this vector the default value of <code>1:n</code>.</p></li>
</ol>
</div>
<div id="environments-in-r" class="section level2" number="8.12">
<h2>
<span class="header-section-number">8.12</span> Environments in R<a class="anchor" aria-label="anchor" href="#environments-in-r"><i class="fas fa-link"></i></a>
</h2>
<p>Study the following parts from the <em>R Language definition Manual</em>: Â§ 3.5 Scope of variables; Chapter 4: <em>Functions</em>.</p>
<p>Consider an R function <code>xx(argument)</code>. Write an R function to add a constant to the correct object (i.e.Â the object in the correct environment) that corresponds to <code>argument</code>. In order to answer this question, you must determine in which environment <code>argument</code> exists and evaluation must take place in this environment. Possible candidates to consider are the <em><span style="color:#3399FF">parent frame</span></em>, the <em><span style="color:#3399FF">global environment</span></em> and the search list. Assume that only the first data basis on the search list is not read-only so that in cases where argument can be found anywhere in the search list it can be assigned to the first data basis. <em>Hint</em>: Study how the following functions work: <code><a href="https://rdrr.io/r/base/assign.html">assign()</a></code>, <code><a href="https://rdrr.io/r/base/deparse.html">deparse()</a></code>, <code><a href="https://rdrr.io/r/base/invisible.html">invisible()</a></code>, <code><a href="https://rdrr.io/r/base/exists.html">exists()</a></code>, <code><a href="https://rdrr.io/r/base/substitute.html">substitute()</a></code>, <code><a href="https://rdrr.io/r/base/sys.parent.html">sys.parent()</a></code>.</p>
</div>
<div id="computing-on-the-language" class="section level2" number="8.13">
<h2>
<span class="header-section-number">8.13</span> âComputing on the languageâ<a class="anchor" aria-label="anchor" href="#computing-on-the-language"><i class="fas fa-link"></i></a>
</h2>
<p>Read <em>R Language Definition Manual Chapter 6: Computing on the language</em>.</p>
</div>
<div id="writing-user-friendly-applications-the-package-shiny" class="section level2" number="8.14">
<h2>
<span class="header-section-number">8.14</span> Writing user friendly applications: the package shiny<a class="anchor" aria-label="anchor" href="#writing-user-friendly-applications-the-package-shiny"><i class="fas fa-link"></i></a>
</h2>
<p>The <code>shiny</code> package in R allows one to create an interactive environment inside R. As an example, the code below generates data from a bivariate normal distribution and makes a scatter plot of the two variables. With shiny a sliding bar is added where the user can adjust the correlation between the two variables.</p>
<p>A shiny app consists of a user interface (<code>ui</code>) a <code>server</code> function and the <code>shinyApp</code> function that uses the <code>ui</code> object and the <code>server</code> function to build a Shiny app object. For the sliding bar, the function <code><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput()</a></code> is used. Table <a href="mapping.html#tab:InputElements">8.1</a> provides a list of different input elements.</p>
<p>The <code>server</code> function uses the <code>inputs</code> â the <code>cor.val</code> in this example â to produce an <code>output</code> â the scatter plot in this example â using a reactive expression â the <code>plot</code> command in this example. The <code>server</code> function and thus the reactive expression is called with every change in the <code>input</code>, i.e.Â the plot is executed with the updated <code>cor.val</code>. The <code>output</code> produced by die <code>server</code> function â <code>scatter</code> in this example â is plotted in the <code>mainPanel</code> with the function <code>plotOutput</code>.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:InputElements">Table 8.1: </span> Input elements for shiny apps.</caption>
<tbody>
<tr class="odd">
<td><code><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton()</a></code></td>
<td><code><a href="https://rdrr.io/pkg/shiny/man/fileInput.html">fileInput()</a></code></td>
<td><code><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput()</a></code></td>
</tr>
<tr class="even">
<td><code><a href="https://rdrr.io/pkg/shiny/man/checkboxGroupInput.html">checkboxGroupInput()</a></code></td>
<td><code><a href="https://rdrr.io/pkg/shiny/man/numericInput.html">numericInput()</a></code></td>
<td><code><a href="https://rdrr.io/pkg/shiny/man/submitButton.html">submitButton()</a></code></td>
</tr>
<tr class="odd">
<td><code><a href="https://rdrr.io/pkg/shiny/man/checkboxInput.html">checkboxInput()</a></code></td>
<td><code><a href="https://rdrr.io/pkg/shiny/man/passwordInput.html">passwordInput()</a></code></td>
<td><code><a href="https://rdrr.io/pkg/shiny/man/textAreaInput.html">textAreaInput()</a></code></td>
</tr>
<tr class="even">
<td><code><a href="https://rdrr.io/pkg/shiny/man/dateInput.html">dateInput()</a></code></td>
<td><code><a href="https://rdrr.io/pkg/shiny/man/radioButtons.html">radioButtons()</a></code></td>
<td><code><a href="https://rdrr.io/pkg/shiny/man/textInput.html">textInput()</a></code></td>
</tr>
<tr class="odd">
<td><code><a href="https://rdrr.io/pkg/shiny/man/dateRangeInput.html">dateRangeInput()</a></code></td>
<td><code><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput()</a></code></td>
<td><code><a href="https://rdrr.io/pkg/shiny/man/varSelectInput.html">varSelectInput()</a></code></td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/">shiny</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/pageWithSidebar.html">pageWithSidebar</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/headerPanel.html">headerPanel</a></span><span class="op">(</span><span class="st">"Bivariate normal plot"</span><span class="op">)</span>,</span>
<span>      <span class="co"># App title</span></span>
<span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span></span>
<span>      <span class="co"># Sidebar panel for inputs</span></span>
<span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span>inputId <span class="op">=</span> <span class="st">"cor.val"</span>,</span>
<span>                      label <span class="op">=</span> <span class="st">"Correlation"</span>,</span>
<span>                      min <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>                      max <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                      value <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                      step <span class="op">=</span> <span class="fl">0.01</span></span>
<span>          <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>      <span class="co"># Main panel for scatter plot</span></span>
<span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">textOutput</a></span><span class="op">(</span><span class="st">"caption"</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"scatter"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>   <span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>         <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span></span>
<span>         <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span>         <span class="va">output</span><span class="op">$</span><span class="va">caption</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderText</a></span><span class="op">(</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span> <span class="op">(</span><span class="st">"Bivariate normal data with </span></span>
<span><span class="st">                                correlation"</span>, <span class="va">input</span><span class="op">$</span><span class="va">cor.val</span><span class="op">)</span></span>
<span>                           <span class="op">}</span><span class="op">)</span></span>
<span>         <span class="va">output</span><span class="op">$</span><span class="va">scatter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span><span class="op">{</span>  </span>
<span>                              <span class="va">sigma</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">sigma</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">cor.val</span></span>
<span>                              <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span><span class="fl">1000</span>, mu<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="va">sigma</span><span class="op">)</span></span>
<span>                              <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">X</span>,asp<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">"red"</span>,pch<span class="op">=</span><span class="fl">15</span><span class="op">)</span></span>
<span>                           <span class="op">}</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
<p>Adjust the shiny app above by adding three more input sources:</p>
<ol style="list-style-type: lower-roman">
<li><p>The number of observations to be generated.</p></li>
<li><p>Selecting the mean vector for the bivariate normal from the following options</p></li>
</ol>
<ul>
<li><span class="math inline">\(\mathbf{\mu}' = [0, 0]\)</span></li>
<li><span class="math inline">\(\mathbf{\mu}' = [10, 2]\)</span></li>
<li><span class="math inline">\(\mathbf{\mu}' = [-3, -3]\)</span></li>
<li><span class="math inline">\(\mathbf{\mu}' = [8, 207]\)</span></li>
</ul>
<ol start="3" style="list-style-type: lower-roman">
<li>Having a series of radio buttons to choose the colour for the observations in the plot.</li>
</ol>
</div>
<div id="exercise-12" class="section level2" number="8.15">
<h2>
<span class="header-section-number">8.15</span> Exercise<a class="anchor" aria-label="anchor" href="#exercise-12"><i class="fas fa-link"></i></a>
</h2>
<div style="color: #80CC99;">
<ol style="list-style-type: lower-alpha">
<li><p>Write an R function to determine which positive whole number elements <span class="math inline">\(â¤10^{10}\)</span> of a given vector are prime and to return these primes. Test this function with randomly generated vectors.</p></li>
<li><p>Repeat (a) using recursion.</p></li>
<li><p>Write a Shiny App that allows the user to choose between one of the data sets:<code>LifeCycleSavings</code> and <code>state.x77</code> as a data matrix <span class="math inline">\(\mathbf{X}:n \times p\)</span>. The unweighted Minkowski metric for the pairwise distance between observation <span class="math inline">\(i\)</span> and observation <span class="math inline">\(j\)</span> is defined as <span class="math inline">\(d_{ij} = \left( \sum_{k=1}^p{|x_{ik}-x_{jk}|^Î»} \right)^{(1/Î»)}\)</span>, <span class="math inline">\(Î»â¥1\)</span>. Make provision for the user to choose the value of <span class="math inline">\(\lambda\)</span> to be used to calculate the pairwise distances between all the rows of the data matrix. Note that <span class="math inline">\(Î»=1\)</span> is the Manhattan distance and <span class="math inline">\(Î»=2\)</span> is the Euclidean distance. Use <span class="math inline">\(Î»=2\)</span> as your default value.</p></li>
</ol>
</div>
</div>
<div id="the-function-on.exit" class="section level2" number="8.16">
<h2>
<span class="header-section-number">8.16</span> The function on.exit()<a class="anchor" aria-label="anchor" href="#the-function-on.exit"><i class="fas fa-link"></i></a>
</h2>
<p>What does the function <code><a href="https://rdrr.io/r/base/on.exit.html">on.exit()</a></code> do?</p>
<p>One use of the special argument <code>...</code> together with the <code><a href="https://rdrr.io/r/base/on.exit.html">on.exit()</a></code> function is to allow a user to make temporary changes to graphical parameters of a graphical display within a function. This can be done as follows:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="mapping.html#cb215-1" tabindex="-1"></a><span class="cf">function</span>(...)</span>
<span id="cb215-2"><a href="mapping.html#cb215-2" tabindex="-1"></a> { oldpar <span class="ot">&lt;-</span> <span class="fu">par</span>(...)</span>
<span id="cb215-3"><a href="mapping.html#cb215-3" tabindex="-1"></a>   <span class="fu">on.exit</span>(<span class="fu">par</span>(oldpar))  </span>
<span id="cb215-4"><a href="mapping.html#cb215-4" tabindex="-1"></a>   or <span class="fu">on.exit</span>(<span class="fu">par</span>(<span class="fu">c</span>(<span class="fu">par</span>(oldpar),<span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)))))</span>
<span id="cb215-5"><a href="mapping.html#cb215-5" tabindex="-1"></a>   new plot instructions</span>
<span id="cb215-6"><a href="mapping.html#cb215-6" tabindex="-1"></a>   ..............................</span>
<span id="cb215-7"><a href="mapping.html#cb215-7" tabindex="-1"></a>  }</span></code></pre></div>
<p>In the above it is assumed that only arguments of <code><a href="https://rdrr.io/r/graphics/par.html">par()</a></code> can be substituted when the function concerned is called. A further use of <code><a href="https://rdrr.io/r/base/on.exit.html">on.exit()</a></code> is for temporarily changing <em><span style="color:#FF9966">options</span></em>.</p>
</div>
<div id="error-tracing" class="section level2" number="8.17">
<h2>
<span class="header-section-number">8.17</span> Error tracing<a class="anchor" aria-label="anchor" href="#error-tracing"><i class="fas fa-link"></i></a>
</h2>
<p>Any error that is generated during the execution of a function will record details of the calls that were being executed at the time. These details can be shown by using the function <code><a href="https://rdrr.io/r/base/traceback.html">traceback()</a></code>. The function <code><a href="https://rdrr.io/r/utils/debugger.html">dump.frames()</a></code> gives more detailed information, but it must be used sparingly because it can create very large objects in the <em><span style="color:#3399FF">workspace</span></em>. The function <code>options (error = xx)</code> can be used to specify the action taken when an error occurs. The recommended option during program development is <code>options(error = recover)</code>. This ensures that an error during an interactive session will call <code><a href="https://rdrr.io/r/utils/recover.html">recover()</a></code> from the lowest relevant function call, usually the call that produced the error. You can then browse in this or any of the currently active calls to recover arbitrary information about the state of computation at the time of the error. An alternative is to set <code>options(error = dump.frames)</code>. This will save all the data in the calls that were active when an error occurred. Calling <code><a href="https://rdrr.io/r/utils/debugger.html">debugger()</a></code> later on produce a similar result to <code><a href="https://rdrr.io/r/utils/recover.html">recover()</a></code>.</p>
<p>The following is a summary of the most common error tracing facilities in R:</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:ErrorTracing">Table 8.2: </span> Error tracing facilities.</caption>
<colgroup>
<col width="31%">
<col width="68%">
</colgroup>
<tbody>
<tr class="odd">
<td>
<code><a href="https://rdrr.io/r/base/print.html">print()</a></code>, <code><a href="https://rdrr.io/r/base/cat.html">cat()</a></code>
</td>
<td>The printing of key values within a function is often all that is needed.</td>
</tr>
<tr class="even">
<td><code><a href="https://rdrr.io/r/base/traceback.html">traceback()</a></code></td>
<td>Must be used together with <code><a href="https://rdrr.io/r/utils/debugger.html">dump.frames()</a></code>.</td>
</tr>
<tr class="odd">
<td><code>options(warn=2)</code></td>
<td>Changes warning to an error that causes a dump.</td>
</tr>
<tr class="even">
<td><code>options(error=)</code></td>
<td>Changes the function that is used for the dump action.</td>
</tr>
<tr class="odd">
<td><code>last.dump()</code></td>
<td>The object in the <em><span style="color:#3399FF">.RData</span></em> that contains a list of calls to dump.</td>
</tr>
<tr class="even">
<td><code><a href="https://rdrr.io/r/utils/debugger.html">debugger()</a></code></td>
<td>Function to inspect last.dump for an error.</td>
</tr>
<tr class="odd">
<td><code><a href="https://rdrr.io/r/base/browser.html">browser()</a></code></td>
<td>Function that can be used within a function to interrupt the latterâs execution so that variables within the local frame concerned can be inspected.</td>
</tr>
<tr class="even">
<td><code><a href="https://rdrr.io/r/base/trace.html">trace()</a></code></td>
<td>Places tracing information before or within functions. Can be used to place calls to the browser at given positions within a function.</td>
</tr>
<tr class="odd">
<td><code><a href="https://rdrr.io/r/base/trace.html">untrace()</a></code></td>
<td>Switches all or some of the functions of <code><a href="https://rdrr.io/r/base/trace.html">trace()</a></code> off.</td>
</tr>
</tbody>
</table></div>
<ol style="list-style-type: lower-alpha">
<li><p>Study the <em>R Language Manual Definition Chapter 9: Debugging</em> for a summary of error tracing facilities in R . Note especially how the functions <code><a href="https://rdrr.io/r/base/print.html">print()</a></code>, <code><a href="https://rdrr.io/r/base/cat.html">cat()</a></code>, <code><a href="https://rdrr.io/r/base/traceback.html">traceback()</a></code>, <code><a href="https://rdrr.io/r/base/browser.html">browser()</a></code>, <code><a href="https://rdrr.io/r/base/trace.html">trace()</a></code>, <code><a href="https://rdrr.io/r/base/trace.html">untrace()</a></code>, <code><a href="https://rdrr.io/r/base/debug.html">debug()</a></code>, <code><a href="https://rdrr.io/r/base/debug.html">undebug()</a></code> and <code>options(warn=2 or error=)</code> work.</p></li>
<li><p>Study usage of: <code>options(error = dump.frames);  debugger()</code></p></li>
<li><p>Study usage of: <code>options(error = dump.frames)</code></p></li>
<li><p>Study usage of the objects <code>last.dump</code> and <code>.Traceback</code>.</p></li>
</ol>
</div>
<div id="error-handling-the-function-try" class="section level2" number="8.18">
<h2>
<span class="header-section-number">8.18</span> Error handling: The function <code>try()</code><a class="anchor" aria-label="anchor" href="#error-handling-the-function-try"><i class="fas fa-link"></i></a>
</h2>
<p>As an example of the need to be able to handle errors properly consider a simulation study involving a large number of repetitive calculations.</p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Example.8.18.a</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">iter</span> <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="op">{</span> <span class="va">select.sample</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> </span>
<span>  <span class="op">{</span> <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span> <span class="op">(</span><span class="fl">100</span>, m <span class="op">=</span> <span class="fl">50</span>, s <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span> <span class="op">(</span><span class="va">temp</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Negative numbers not allowed"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span>                                                         <span class="op">}</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">iter</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu">select.sample</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>With <code>iter</code> set to a large value, inevitably a call to <code>Example.8.18.a()</code> will result in an error message:</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb217-1"><a href="mapping.html#cb217-1" tabindex="-1"></a>&gt; Example.8.18.a()</span>
<span id="cb217-2"><a href="mapping.html#cb217-2" tabindex="-1"></a>Error in select.sample(i) : Negative numbers not allowed.</span></code></pre></div>
<p>To see how <code><a href="https://rdrr.io/r/base/try.html">try()</a></code> can be used make the following change in <code>Example.8.18.a()</code>:</p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Example.8.18.b</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">iter</span> <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="op">{</span> <span class="va">select.sample</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> </span>
<span>  <span class="op">{</span> <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span> <span class="op">(</span><span class="fl">100</span>, m <span class="op">=</span> <span class="fl">50</span>, s <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span> <span class="op">(</span><span class="va">temp</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Negative numbers not allowed"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span>                                                         <span class="op">}</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">iter</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> </span>
<span>                        <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">select.sample</span><span class="op">(</span><span class="va">i</span><span class="op">)</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>A typical chunk of output from a call to <code>Example.8.18.b()</code> is</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb219-1"><a href="mapping.html#cb219-1" tabindex="-1"></a>&gt; Example.8.18.b(2)</span>
<span id="cb219-2"><a href="mapping.html#cb219-2" tabindex="-1"></a>[[1]]</span>
<span id="cb219-3"><a href="mapping.html#cb219-3" tabindex="-1"></a>[1] 3.804975</span>
<span id="cb219-4"><a href="mapping.html#cb219-4" tabindex="-1"></a>[[2]]</span>
<span id="cb219-5"><a href="mapping.html#cb219-5" tabindex="-1"></a>[1] "Error in select.sample(i) : Negative numbers not allowed\n"</span>
<span id="cb219-6"><a href="mapping.html#cb219-6" tabindex="-1"></a>attr(,"class")</span>
<span id="cb219-7"><a href="mapping.html#cb219-7" tabindex="-1"></a>[1] "try-error"</span>
<span id="cb219-8"><a href="mapping.html#cb219-8" tabindex="-1"></a>attr(,"condition")</span>
<span id="cb219-9"><a href="mapping.html#cb219-9" tabindex="-1"></a>&lt;simpleError in select.sample(i): Negative numbers not allowed&gt;</span></code></pre></div>
<p>Notice that execution of <code>Example.8.18.b</code> was not halted prematurely. From the above output we can make some final changes to our example function:</p>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Example.8.18.c</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">iter</span> <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="op">{</span> <span class="va">select.sample</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> </span>
<span>  <span class="op">{</span> <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span> <span class="op">(</span><span class="fl">100</span>, m <span class="op">=</span> <span class="fl">50</span>, s <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span> <span class="op">(</span><span class="va">temp</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Negative numbers not allowed"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span>                                                         <span class="op">}</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">iter</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> </span>
<span>                        <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">select.sample</span><span class="op">(</span><span class="va">i</span><span class="op">)</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">out</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>                     <span class="op">{</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span> <span class="op">(</span><span class="va">x</span>,<span class="st">"condition"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span></span>
<span>                       <span class="kw">else</span> <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"condition"</span><span class="op">)</span></span>
<span>                     <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="va">Error.report</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">out</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> </span>
<span>                              <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="va">x</span>, <span class="st">"No Error"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">Numeric.results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">out</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>   </span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="va">x</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span> <span class="op">(</span>Error.report <span class="op">=</span> <span class="va">Error.report</span>, Numeric.results <span class="op">=</span> <span class="va">Numeric.results</span><span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Study the output of a call to <code>Example.8.18.c</code> and comment on the merits of <code><a href="https://rdrr.io/r/base/try.html">try()</a></code> in this example.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="functions.html"><span class="header-section-number">7</span> Writing functions in R</a></div>
<div class="next"><a href="data.html"><span class="header-section-number">9</span> Reading data files into R, formatting and printing</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#mapping"><span class="header-section-number">8</span> Vectorized programming and mapping functions</a></li>
<li><a class="nav-link" href="#mapping-functions-to-a-matrix"><span class="header-section-number">8.1</span> Mapping functions to a matrix</a></li>
<li><a class="nav-link" href="#mapping-functions-to-vectors-dataframes-and-lists"><span class="header-section-number">8.2</span> Mapping functions to vectors, dataframes and lists</a></li>
<li><a class="nav-link" href="#the-functions-mapply-rapply-and-vectorize"><span class="header-section-number">8.3</span> The functions: mapply(), rapply() and Vectorize()</a></li>
<li><a class="nav-link" href="#the-mapping-function-tapply-for-grouped-data"><span class="header-section-number">8.4</span> The mapping function tapply() for grouped data</a></li>
<li><a class="nav-link" href="#the-control-of-execution-flow-statement-if-else-and-the-control-functions-ifelse-and-switch"><span class="header-section-number">8.5</span> The control of execution flow statement if-else and the control functions ifelse() and switch()</a></li>
<li><a class="nav-link" href="#loops-in-r"><span class="header-section-number">8.6</span> Loops in R</a></li>
<li><a class="nav-link" href="#the-execution-time-of-r-tasks"><span class="header-section-number">8.7</span> The execution time of R tasks</a></li>
<li><a class="nav-link" href="#the-calling-of-functions-with-argument-lists"><span class="header-section-number">8.8</span> The calling of functions with argument lists</a></li>
<li><a class="nav-link" href="#evaluating-r-strings-a-commands"><span class="header-section-number">8.9</span> Evaluating R strings a commands</a></li>
<li><a class="nav-link" href="#object-oriented-programming-in-r"><span class="header-section-number">8.10</span> Object oriented programming in R</a></li>
<li><a class="nav-link" href="#recursion"><span class="header-section-number">8.11</span> Recursion</a></li>
<li><a class="nav-link" href="#environments-in-r"><span class="header-section-number">8.12</span> Environments in R</a></li>
<li><a class="nav-link" href="#computing-on-the-language"><span class="header-section-number">8.13</span> âComputing on the languageâ</a></li>
<li><a class="nav-link" href="#writing-user-friendly-applications-the-package-shiny"><span class="header-section-number">8.14</span> Writing user friendly applications: the package shiny</a></li>
<li><a class="nav-link" href="#exercise-12"><span class="header-section-number">8.15</span> Exercise</a></li>
<li><a class="nav-link" href="#the-function-on.exit"><span class="header-section-number">8.16</span> The function on.exit()</a></li>
<li><a class="nav-link" href="#error-tracing"><span class="header-section-number">8.17</span> Error tracing</a></li>
<li><a class="nav-link" href="#error-handling-the-function-try"><span class="header-section-number">8.18</span> Error handling: The function try()</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/sugnet/RTutorial/blob/master/08-mapping.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/sugnet/RTutorial/edit/master/08-mapping.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Introduction into R Applications and Programming: A Tutorial</strong>" was written by NiÃ«l J le Roux and Sugnet Lubbe. It was last built on 2025.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
